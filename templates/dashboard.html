{% extends "base.html" %}

{% block title %}لوحة التحكم - نظام إدارة الموظفين{% endblock %}

{% block content %}
<div class="container-fluid p-4">
    <h1 class="mb-4 text-dark">إحصائيات البريد الإلكتروني</h1>
    
    <!-- Email Categories Cards -->
    <div class="row mb-4">
        <div class="col-12">
        </div>
        {% for category, count in email_categories.items() %}
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card stats-card text-center h-100">
                <div class="card-body">
                    <i class="fas fa-envelope fa-2x {% if category == 'Organization' %}text-primary{% elif category == 'Lab' %}text-warning{% elif category == 'Request' %}text-info{% else %}text-secondary{% endif %} mb-3"></i>
                    <h5 class="card-title text-dark mb-2">
                        {% if category == 'Organization' %}المؤسسة
                        {% elif category == 'Lab' %}المختبر
                        {% elif category == 'Request' %}الطلبات
                        {% else %}أخرى{% endif %}
                    </h5>
                    <h2 class="text-dark mb-1">{{ count }}</h2>
                    <small class="text-muted">إجمالي الرسائل</small>
                    <div class="mt-2">
                        <small class="text-success">غير مقروءة: {{ (count * 0.2) | int }}</small>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Charts Section -->
    <div class="row mb-4">
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">توزيع فئات تصنيف الرسائل</h5>
                </div>
                <div class="card-body">
                    <canvas id="emailPieChart" width="400" height="400"></canvas>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">عدد الموظفين الحاليين لكل قسم</h5>
                </div>
                <div class="card-body">
                    <canvas id="departmentBarChart" width="400" height="400"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Employees Table -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">بيانات الموظفين</h5>
                    <div class="d-flex gap-2">
                        <input type="text" id="searchInput" class="form-control form-control-sm" 
                               placeholder="البحث بالاسم أو البريد الإلكتروني" style="width: 250px;">
                        <select id="deptFilter" class="form-select form-select-sm" style="width: 120px;">
                            <option value="">كل الأقسام</option>
                            <option value="d">D</option>
                            <option value="f">F</option>
                            <option value="e">E</option>
                            <option value="md">MD</option>
                        </select>
                        <select id="dayFilter" class="form-select form-select-sm" style="width: 150px;">
                            <option value="">كل الأيام</option>
                            <option value="suntue">الأحد-الثلاثاء</option>
                            <option value="wedthu">الأربعاء-الخميس</option>
                            <option value="frisat">الجمعة-السبت</option>
                        </select>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="employeesTable">
                            <thead class="table-dark">
                                <tr>
                                    <th>الاسم</th>
                                    <th>البريد الإلكتروني</th>
                                    <th>القسم</th>
                                    <th>الإجمالي (الرسائل المرسلة)</th>
                                    <th>المعالجة (الرسائل المعالجة)</th>
                                </tr>
                            </thead>
                            <tbody id="employeesTableBody">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <nav>
                        <ul class="pagination justify-content-center" id="pagination">
                            <!-- Will be populated by JavaScript -->
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}

{% block scripts %}
<script>
    // Data for charts
    const emailCategories = {{ email_categories | tojson }};
    const deptStats = {{ dept_stats | tojson }};
    const employees = {{ employees | tojson }};
    
    // Initialize dashboard
    initializeDashboard(emailCategories, deptStats, employees);
</script>
{% endblock %}
